@using BikeStoresSystem.ViewModels
@using System.Linq
@{
    ViewBag.Title = "Maintain Records";
    var staffList = ViewBag.Staffs as List<StaffViewModel> ?? new List<StaffViewModel>();
}

<style>
    .maintain-section {
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        overflow: hidden;
        transition: all 0.3s;
    }

        .maintain-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

    .maintain-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .maintain-header h4 {
            margin: 0;
            font-weight: 600;
            font-size: 1.3rem;
        }

    .maintain-body {
        padding: 25px;
    }

    .record-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        position: relative;
        transition: all 0.3s;
    }

        .record-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px 0 0 15px;
        }

        .record-card:hover {
            border-color: #667eea;
            transform: translateX(8px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

    .record-field {
        margin-bottom: 12px;
    }

    .record-label {
        font-weight: 600;
        color: #667eea;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 3px;
    }

    .record-value {
        font-size: 1rem;
        color: #2d3748;
        font-weight: 500;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px dashed #e9ecef;
    }

    .btn-action {
        flex: 1;
        border: none;
        padding: 10px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }

    .btn-edit {
        background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        color: white;
    }

        .btn-edit:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 167, 38, 0.4);
        }

    .btn-update {
        background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
        color: white;
    }

        .btn-update:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 187, 106, 0.4);
        }

    .btn-delete {
        background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
        color: white;
    }

        .btn-delete:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(239, 83, 80, 0.4);
        }

    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        border-radius: 20px;
        margin-bottom: 40px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

    .pagination-custom {
        display: flex;
        justify-content: center;
        gap: 5px;
        margin-top: 20px;
    }

        .pagination-custom button {
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

            .pagination-custom button:hover {
                transform: scale(1.1);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            }

    /* ---------- PRODUCT IMAGE: reserve space + style ---------- */

    /* Only product record-cards get extra right padding so text never sits under the image */
    .product-card {
        padding: 20px 150px 20px 20px; /* top right bottom left */
    }

    /* small image styling (top-right) */
    .record-image {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 120px;
        max-height: 110px;
        height: auto;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        background: white;
        padding: 6px;
    }

    /* Hide on very small screens and restore normal padding */
    @@media (max-width: 576px) {
        .record-image {
            display: none;
        }

        .product-card {
            padding-right: 20px;
        }
    }
</style>

<div class="page-header">
    <h1><i class="fas fa-cogs"></i> Maintain</h1>
    <p class="mb-0" style="font-size: 1.1rem; opacity: 0.95;">Edit, Update, and Delete Records</p>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="maintain-section">
            <div class="maintain-header">
                <h4><i class="fas fa-users"></i> Staff list</h4>
            </div>
            <div class="maintain-body">
                <div id="staffListMaintain">
                    @{ var firstStaff = staffList.FirstOrDefault(); }
                    @if (firstStaff != null)
                    {
                        <div class="record-card" id="staffMaintainCard">
                            <div class="record-field">
                                <div class="record-label">First Name</div>
                                <div class="record-value" id="mStaffFirstName">@firstStaff.first_name</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label">Last Name</div>
                                <div class="record-value" id="mStaffLastName">@firstStaff.last_name</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label">Staff ID</div>
                                <div class="record-value" id="mStaffId">#@firstStaff.staff_id</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label">Email</div>
                                <div class="record-value" style="font-size: 0.9rem;" id="mStaffEmail">@firstStaff.email</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label">Store</div>
                                <div class="record-value" id="mStaffStore">@firstStaff.store_name</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label">Status</div>
                                <div id="mStaffStatus">
                                    @if (firstStaff.active == 1)
                                    {
                                        <span class="badge bg-success"><i class="fas fa-check"></i> Active</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary"><i class="fas fa-times"></i> Inactive</span>
                                    }
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn-action btn-edit" id="btnEditStaff" onclick="editStaff(@firstStaff.staff_id)">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-action btn-delete" id="btnDeleteStaff" onclick="deleteStaff(@firstStaff.staff_id)">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="record-card text-center">
                            <p class="text-muted"><i class="fas fa-info-circle"></i> No staff found</p>
                        </div>
                    }
                </div>

                <div class="pagination-custom mt-3">
                    <button onclick="changeMaintainStaffPage(-1)"><i class="fas fa-chevron-left"></i></button>
                    <button id="staffMaintainPageNum">1 / @staffList.Count()</button>
                    <button onclick="changeMaintainStaffPage(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="maintain-section">
            <div class="maintain-header" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <h4><i class="fas fa-user-friends"></i> Customer list</h4>
            </div>
            <div class="maintain-body">
                <div id="customerListMaintain">
                    @{
                        var customers = (ViewBag.Customers as List<CustomerViewModel>) ?? new List<CustomerViewModel>();
                        var firstCust = customers.FirstOrDefault();
                    }
                    @if (firstCust != null)
                    {
                        <div class="record-card" style="border-color: #ffe0e6;" id="customerMaintainCard">
                            <div class="record-field">
                                <div class="record-label" style="color: #f5576c;">First Name</div>
                                <div class="record-value" id="mCustFirstName">@firstCust.first_name</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label" style="color: #f5576c;">Last Name</div>
                                <div class="record-value" id="mCustLastName">@firstCust.last_name</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label" style="color: #f5576c;">Customer ID</div>
                                <div class="record-value" id="mCustId">#@firstCust.customer_id</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label" style="color: #f5576c;">Email</div>
                                <div class="record-value" style="font-size: 0.9rem;" id="mCustEmail">@firstCust.email</div>
                            </div>
                            <div class="record-field">
                                <div class="record-label" style="color: #f5576c;">Location</div>
                                <div class="record-value" id="mCustLocation">@firstCust.city, @firstCust.state</div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn-action btn-edit" id="btnEditCustomer" onclick="editCustomer(@firstCust.customer_id)">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-action btn-delete" id="btnDeleteCustomer" onclick="deleteCustomer(@firstCust.customer_id)">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="record-card text-center">
                            <p class="text-muted"><i class="fas fa-info-circle"></i> No customers found</p>
                        </div>
                    }
                </div>

                <div class="pagination-custom mt-3">
                    <button onclick="changeMaintainCustomerPage(-1)"><i class="fas fa-chevron-left"></i></button>
                    <button id="customerMaintainPageNum">1 / @customers.Count()</button>
                    <button onclick="changeMaintainCustomerPage(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="maintain-section">
            <div class="maintain-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <h4><i class="fas fa-bicycle"></i> Product list</h4>
            </div>
            <div class="maintain-body">
                <div id="productListMaintain">
                    @{
                        var products = (ViewBag.Products as List<ProductViewModel>) ?? new List<ProductViewModel>();
                        var firstProd = products.FirstOrDefault();
                        var defaultProdImage = Url.Content("~/Images/Bikes-Images/Electra_Cruiser.jpeg");
                    }
                    @if (firstProd != null)
                    {
                        <!-- add class product-card so this record reserves space for the image -->
                        <div class="record-card product-card" style="border-color: #e0f7ff;" id="productMaintainCard">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-bicycle fa-2x" style="color: #00f2fe; margin-right: 12px;"></i>
                                <div>
                                    <div class="record-label" style="color: #00f2fe;">Product Details</div>
                                    <div class="record-value" id="mProdName">@firstProd.product_name</div>
                                </div>
                            </div>

                            <!-- small product image (top-right). initial src uses default image; JS will update if product has image info -->
                            <img id="mProdImage" class="record-image" src="@defaultProdImage" alt="Product image" />

                            <div class="row">
                                <div class="col-6">
                                    <div class="record-field">
                                        <div class="record-label" style="color: #00f2fe;">Brand</div>
                                        <span class="badge" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" id="mProdBrand">
                                            @firstProd.brand_name
                                        </span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="record-field">
                                        <div class="record-label" style="color: #00f2fe;">Category</div>
                                        <span class="badge bg-info" id="mProdCategory">@firstProd.category_name</span>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="col-6">
                                    <div class="record-field">
                                        <div class="record-label" style="color: #00f2fe;">Model Year</div>
                                        <div class="record-value" id="mProdYear">@firstProd.model_year</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="record-field">
                                        <div class="record-label" style="color: #00f2fe;">Price</div>
                                        <div class="record-value" style="color: #00f2fe; font-weight: 700;" id="mProdPrice">
                                            @firstProd.list_price.ToString("C")
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn-action btn-edit" id="btnEditProduct" onclick="editProduct(@firstProd.product_id)">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-action btn-delete" id="btnDeleteProduct" onclick="deleteProduct(@firstProd.product_id)">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="record-card text-center">
                            <p class="text-muted"><i class="fas fa-info-circle"></i> No products found</p>
                        </div>
                    }
                </div>

                <div class="pagination-custom mt-3">
                    <button onclick="changeMaintainProductPage(-1)"><i class="fas fa-chevron-left"></i></button>
                    <button id="productMaintainPageNum">1 / @products.Count()</button>
                    <button onclick="changeMaintainProductPage(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editStaffModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 20px; border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%); color: white; border-radius: 20px 20px 0 0;">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Staff Member</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <form id="editStaffForm">
                    <input type="hidden" id="editStaffId">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label record-label">First Name *</label>
                            <input type="text" class="form-control" id="editStaffFirstName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Last Name *</label>
                            <input type="text" class="form-control" id="editStaffLastName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Email *</label>
                            <input type="email" class="form-control" id="editStaffEmail" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Phone</label>
                            <input type="text" class="form-control" id="editStaffPhone">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Store *</label>
                            <select class="form-select" id="editStaffStore" required>
                                @foreach (var store in ViewBag.Stores)
                                {
                                    <option value="@store.store_id">@store.store_name</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Manager</label>
                            <select class="form-select" id="editStaffManager"></select>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label record-label">Active Status *</label>
                            <select class="form-select" id="editStaffActive" required>
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border: none; padding: 20px 30px;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn-action btn-update" onclick="updateStaff()">
                    <i class="fas fa-save"></i> Update Staff
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editCustomerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 20px; border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%); color: white; border-radius: 20px 20px 0 0;">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Customer</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <form id="editCustomerForm">
                    <input type="hidden" id="editCustId">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label record-label">First Name *</label>
                            <input type="text" class="form-control" id="editCustFirstName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Last Name *</label>
                            <input type="text" class="form-control" id="editCustLastName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Email</label>
                            <input type="email" class="form-control" id="editCustEmail">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Phone</label>
                            <input type="text" class="form-control" id="editCustPhone">
                        </div>
                        <div class="col-md-12">
                            <label class="form-label record-label">Street</label>
                            <input type="text" class="form-control" id="editCustStreet">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label record-label">City</label>
                            <input type="text" class="form-control" id="editCustCity">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label record-label">State</label>
                            <input type="text" class="form-control" id="editCustState">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label record-label">Zip Code</label>
                            <input type="text" class="form-control" id="editCustZip">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border: none; padding: 20px 30px;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn-action btn-update" onclick="updateCustomer()">
                    <i class="fas fa-save"></i> Update Customer
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editProductModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 20px; border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%); color: white; border-radius: 20px 20px 0 0;">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Product</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <form id="editProductForm">
                    <input type="hidden" id="editProdId">
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label class="form-label record-label">Product Name *</label>
                            <input type="text" class="form-control" id="editProdName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Brand *</label>
                            <select class="form-select" id="editProdBrand" required>
                                @foreach (var brand in ViewBag.Brands)
                                {
                                    <option value="@brand.brand_id">@brand.brand_name</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Category *</label>
                            <select class="form-select" id="editProdCategory" required>
                                @foreach (var category in ViewBag.Categories)
                                {
                                    <option value="@category.category_id">@category.category_name</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">Model Year *</label>
                            <input type="number" class="form-control" id="editProdYear" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label record-label">List Price *</label>
                            <input type="number" step="0.01" class="form-control" id="editProdPrice" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border: none; padding: 20px 30px;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn-action btn-update" onclick="updateProduct()">
                    <i class="fas fa-save"></i> Update Product
                </button>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        let maintainStaff = @Html.Raw(Json.Encode(staffList));
        let maintainCustomers = @Html.Raw(Json.Encode(ViewBag.Customers ?? new List<object>()));
        let maintainProducts = @Html.Raw(Json.Encode(ViewBag.Products ?? new List<object>()));

        // server-resolved default image path
        const defaultProdImg = '@Url.Content("~/Images/Bikes-Images/Electra_Cruiser.jpeg")';

        let maintainStaffIndex = 0;
        let maintainCustomerIndex = 0;
        let maintainProductIndex = 0;

        $(document).ready(function () {
            console.log("Maintain page loaded");
            console.log("Staff count:", maintainStaff.length);
            console.log("Customer count:", maintainCustomers.length);
            console.log("Product count:", maintainProducts.length);
            loadManagers();

            // set initial product image (if product exists)
            if (maintainProducts && maintainProducts.length > 0) {
                const p = maintainProducts[0];
                const src = p && (p.image_url || p.image_path) ? (p.image_url || p.image_path) : defaultProdImg;
                $('#mProdImage').attr('src', src);
            } else {
                $('#mProdImage').attr('src', defaultProdImg);
            }
        });

        window.changeMaintainStaffPage = function(direction) {
            console.log("changeMaintainStaffPage called:", direction);
            if (maintainStaff.length === 0) return;

            maintainStaffIndex += direction;
            if (maintainStaffIndex < 0) maintainStaffIndex = maintainStaff.length - 1;
            if (maintainStaffIndex >= maintainStaff.length) maintainStaffIndex = 0;

            const staff = maintainStaff[maintainStaffIndex];
            $('#mStaffFirstName').text(staff.first_name);
            $('#mStaffLastName').text(staff.last_name);
            $('#mStaffId').text('#' + staff.staff_id);
            $('#mStaffEmail').text(staff.email);
            $('#mStaffStore').text(staff.store_name);

            const statusBadge = staff.active === 1
                ? '<span class="badge bg-success"><i class="fas fa-check"></i> Active</span>'
                : '<span class="badge bg-secondary"><i class="fas fa-times"></i> Inactive</span>';
            $('#mStaffStatus').html(statusBadge);

            $('#btnEditStaff').attr('onclick', 'editStaff(' + staff.staff_id + ')');
            $('#btnDeleteStaff').attr('onclick', 'deleteStaff(' + staff.staff_id + ')');

            $('#staffMaintainPageNum').text((maintainStaffIndex + 1) + ' / ' + maintainStaff.length);
        }

        window.changeMaintainCustomerPage = function(direction) {
            console.log("changeMaintainCustomerPage called:", direction);
            if (maintainCustomers.length === 0) return;

            maintainCustomerIndex += direction;
            if (maintainCustomerIndex < 0) maintainCustomerIndex = maintainCustomers.length - 1;
            if (maintainCustomerIndex >= maintainCustomers.length) maintainCustomerIndex = 0;

            const customer = maintainCustomers[maintainCustomerIndex];
            $('#mCustFirstName').text(customer.first_name);
            $('#mCustLastName').text(customer.last_name);
            $('#mCustId').text('#' + customer.customer_id);
            $('#mCustEmail').text(customer.email || 'N/A');
            $('#mCustLocation').text((customer.city || 'N/A') + ', ' + (customer.state || 'N/A'));

            $('#btnEditCustomer').attr('onclick', 'editCustomer(' + customer.customer_id + ')');
            $('#btnDeleteCustomer').attr('onclick', 'deleteCustomer(' + customer.customer_id + ')');

            $('#customerMaintainPageNum').text((maintainCustomerIndex + 1) + ' / ' + maintainCustomers.length);
        }

        window.changeMaintainProductPage = function(direction) {
            console.log("changeMaintainProductPage called:", direction);
            if (maintainProducts.length === 0) return;

            maintainProductIndex += direction;
            if (maintainProductIndex < 0) maintainProductIndex = maintainProducts.length - 1;
            if (maintainProductIndex >= maintainProducts.length) maintainProductIndex = 0;

            const product = maintainProducts[maintainProductIndex];
            $('#mProdName').text(product.product_name);
            $('#mProdBrand').text(product.brand_name);
            $('#mProdCategory').text(product.category_name);
            $('#mProdYear').text(product.model_year);
            $('#mProdPrice').text('$' + product.list_price.toFixed(2));

            // update the small product image (prefers product.image_url or image_path)
            const imgSrc = (product && (product.image_url || product.image_path)) ? (product.image_url || product.image_path) : defaultProdImg;
            $('#mProdImage').attr('src', imgSrc);

            $('#btnEditProduct').attr('onclick', 'editProduct(' + product.product_id + ')');
            $('#btnDeleteProduct').attr('onclick', 'deleteProduct(' + product.product_id + ')');

            $('#productMaintainPageNum').text((maintainProductIndex + 1) + ' / ' + maintainProducts.length);
        }

        function loadManagers() {
            $.ajax({
                url: '@Url.Action("GetManagers", "Maintain")',
                type: 'GET',
                success: function (data) {
                    var select = $('#editStaffManager');
                    select.empty();
                    select.append('<option value="">No Manager</option>');
                    $.each(data, function (i, manager) {
                        select.append('<option value="' + manager.staff_id + '">' + manager.name + '</option>');
                    });
                }
            });
        }

        window.editStaff = function(id) {
            console.log("editStaff called with id:", id);
            $.ajax({
                url: '@Url.Action("GetStaff", "Maintain")',
                type: 'GET',
                data: { id: id },
                success: function (staff) {
                    if (staff) {
                        $('#editStaffId').val(staff.staff_id);
                        $('#editStaffFirstName').val(staff.first_name);
                        $('#editStaffLastName').val(staff.last_name);
                        $('#editStaffEmail').val(staff.email);
                        $('#editStaffPhone').val(staff.phone);
                        $('#editStaffStore').val(staff.store_id);
                        $('#editStaffManager').val(staff.manager_id || '');
                        $('#editStaffActive').val(staff.active);
                        $('#editStaffModal').modal('show');
                    }
                }
            });
        }

        window.updateStaff = function() {
            console.log("updateStaff called");
            var staffData = {
                staff_id: $('#editStaffId').val(),
                first_name: $('#editStaffFirstName').val(),
                last_name: $('#editStaffLastName').val(),
                email: $('#editStaffEmail').val(),
                phone: $('#editStaffPhone').val(),
                store_id: $('#editStaffStore').val(),
                manager_id: $('#editStaffManager').val() || null,
                active: $('#editStaffActive').val()
            };

            $.ajax({
                url: '@Url.Action("UpdateStaff", "Maintain")',
                type: 'POST',
                data: staffData,
                success: function (response) {
                    if (response.success) {
                        alert(response.message);
                        location.reload();
                    } else {
                        alert(response.message);
                    }
                }
            });
        }

        window.deleteStaff = function(id) {
            console.log("deleteStaff called with id:", id);
            if (confirm('Are you sure you want to delete this staff member?')) {
                $.ajax({
                    url: '@Url.Action("DeleteStaff", "Maintain")',
                    type: 'POST',
                    data: { id: id },
                    success: function (response) {
                        if (response.success) {
                            alert(response.message);
                            location.reload();
                        } else {
                            alert(response.message);
                        }
                    }
                });
            }
        }

        window.editCustomer = function(id) {
            console.log("editCustomer called with id:", id);
            $.ajax({
                url: '@Url.Action("GetCustomer", "Maintain")',
                type: 'GET',
                data: { id: id },
                success: function (customer) {
                    if (customer) {
                        $('#editCustId').val(customer.customer_id);
                        $('#editCustFirstName').val(customer.first_name);
                        $('#editCustLastName').val(customer.last_name);
                        $('#editCustEmail').val(customer.email);
                        $('#editCustPhone').val(customer.phone);
                        $('#editCustStreet').val(customer.street);
                        $('#editCustCity').val(customer.city);
                        $('#editCustState').val(customer.state);
                        $('#editCustZip').val(customer.zip_code);
                        $('#editCustomerModal').modal('show');
                    }
                }
            });
        }

        window.updateCustomer = function() {
            console.log("updateCustomer called");
            var customerData = {
                customer_id: $('#editCustId').val(),
                first_name: $('#editCustFirstName').val(),
                last_name: $('#editCustLastName').val(),
                email: $('#editCustEmail').val(),
                phone: $('#editCustPhone').val(),
                street: $('#editCustStreet').val(),
                city: $('#editCustCity').val(),
                state: $('#editCustState').val(),
                zip_code: $('#editCustZip').val()
            };

            $.ajax({
                url: '@Url.Action("UpdateCustomer", "Maintain")',
                type: 'POST',
                data: customerData,
                success: function (response) {
                    if (response.success) {
                        alert(response.message);
                        location.reload();
                    } else {
                        alert(response.message);
                    }
                }
            });
        }

        window.deleteCustomer = function(id) {
            console.log("deleteCustomer called with id:", id);
            if (confirm('Are you sure you want to delete this customer?')) {
                $.ajax({
                    url: '@Url.Action("DeleteCustomer", "Maintain")',
                    type: 'POST',
                    data: { id: id },
                    success: function (response) {
                        if (response.success) {
                            alert(response.message);
                            location.reload();
                        } else {
                            alert(response.message);
                        }
                    }
                });
            }
        }

        window.editProduct = function(id) {
            console.log("editProduct called with id:", id);
            $.ajax({
                url: '@Url.Action("GetProduct", "Maintain")',
                type: 'GET',
                data: { id: id },
                success: function (product) {
                    if (product) {
                        $('#editProdId').val(product.product_id);
                        $('#editProdName').val(product.product_name);
                        $('#editProdBrand').val(product.brand_id);
                        $('#editProdCategory').val(product.category_id);
                        $('#editProdYear').val(product.model_year);
                        $('#editProdPrice').val(product.list_price);
                        $('#editProductModal').modal('show');
                    }
                }
            });
        }

        window.updateProduct = function() {
            console.log("updateProduct called");
            var productData = {
                product_id: $('#editProdId').val(),
                product_name: $('#editProdName').val(),
                brand_id: $('#editProdBrand').val(),
                category_id: $('#editProdCategory').val(),
                model_year: $('#editProdYear').val(),
                list_price: $('#editProdPrice').val()
            };

            $.ajax({
                url: '@Url.Action("UpdateProduct", "Maintain")',
                type: 'POST',
                data: productData,
                success: function (response) {
                    if (response.success) {
                        alert(response.message);
                        location.reload();
                    } else {
                        alert(response.message);
                    }
                }
            });
        }

        window.deleteProduct = function(id) {
            console.log("deleteProduct called with id:", id);
            if (confirm('Are you sure you want to delete this product?')) {
                $.ajax({
                    url: '@Url.Action("DeleteProduct", "Maintain")',
                    type: 'POST',
                    data: { id: id },
                    success: function (response) {
                        if (response.success) {
                            alert(response.message);
                            location.reload();
                        } else {
                            alert(response.message);
                        }
                    }
                });
            }
        }
    </script>
}
